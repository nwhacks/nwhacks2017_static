Polymer({is:'checkin-page',properties:{display:{value:!1}},observers:['handleRegistrations(registrations)','handleSearch(query, lunr)','updateStatus(display.checked_in)'],ready:function(){this.$.search.addEventListener('keydown',c=>{if(c.stopPropagation(),'ArrowDown'===c.code)this.autocompleteIndex=Math.min(this.autocompleteIndex+1,this.autocomplete.length-1);else if('ArrowUp'===c.code)this.autocompleteIndex=Math.max(this.autocompleteIndex-1,0);else if('Enter'===c.code)this.select();else return;c.preventDefault()}),this.keyHandler=this.keyHandler.bind(this)},attached:function(){document.addEventListener('keydown',this.keyHandler)},detached:function(){document.removeEventListener('keydown',this.keyHandler)},keyHandler:function(c){if('Slash'===c.code)this.$.search.inputElement.focus();else if('Space'===c.code&&this.display)this.set('display.checked_in',!this.display.checked_in);else return;c.preventDefault()},handleTap:function(c){this.autocompleteIndex=c.model.index,this.select()},select:function(){const c=this.autocomplete[this.autocompleteIndex];if(c){this.displayID=c;const d=this.registrations[c];void 0===d.checked_in&&(d.checked_in=!1),this.query='',this.display=d,this.autocomplete=[],this.$.search.inputElement.blur()}},heading:function(c){return c.name+' <'+c.email+'>'},eq:function(c,d){return c===d},handleRegistrations:function(c){this.updateLunrIndex(c)},handleSearch:function(c){const f=this.lunr.search(c).slice(0,5).map(g=>g.ref);JSON.stringify(f)!==JSON.stringify(this.autocomplete)&&(this.autocompleteIndex=0,this.autocomplete=f,this.display=!1)},updateLunrIndex:function(c){const d=Object.keys(c).length;if(this.lastLunrIndexCount!==d){this.lastLunrIndexCount=d;const f=lunr(function(){this.ref('id'),this.field('email'),this.field('emailSplit'),this.field('name')});for(let g of Object.keys(c)){const h=c[g];f.add({id:g,email:h.email,emailSplit:h.email.replace(/\W+/g,' '),name:h.name})}this.lunr=f}},name:function(c,d){return c[d].name},email:function(c,d){return c[d].email},warnStatus:function(c){const d=this.displayStatus(c);return'Accepted, No Response'===d||'waitlisted'===d},dangerStatus:function(c){const d=this.displayStatus(c);return'rejected'===d},displayStatus:function(c){return'accepted'===c.status?c.rsvp?'accepted':'Accepted, No Response':c.status},warnAge:function(c){return c&&-1!==c.indexOf('under')},updateStatus:function(){const c=this.querySelector('#regs');c&&this.displayID&&this.display&&c.setStoredValue('/registrations/'+this.displayID+'/checked_in',this.display.checked_in)}});