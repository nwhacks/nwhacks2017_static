<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../neon-animation/animations/opaque-animation.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

</head><body><dom-module id="lazy-pages">
  <template>
    <style>:host{display:block;position:relative;overflow:hidden;}:host > ::content > *{position:absolute;top:0;left:0;bottom:0;right:0;height:100%;}:host > ::content > :not(.iron-selected):not(.neon-animating){display:none !important;}:host > ::content > .neon-animating{pointer-events:none;}</style>
    <content id="content"></content>
  </template>
</dom-module>

<script>(function(){'use strict';var a=function(b){this.lazy=b,this._boundDomChange=this.handleDomChange.bind(this)};a.prototype={start:function(b,c,d){this.entryPage=this.entryInstance=b,this.exitPage=this.exitInstance=c,this.entrySelected=d,this.isTemplate(this.exitPage)&&(this.exitInstance=this.lazy._getInstanceElement(this.exitPage));this.exitInstance&&(Polymer.dom(this.exitInstance).classList.add('neon-animating'),Polymer.dom(this.exitInstance).classList.remove('iron-selected')),this.lazy._setSelectedItem(this.entryPage),this.isTemplate(this.entryPage)?(this.entryPage.addEventListener('dom-change',this._boundDomChange),this.entryPage.if&&console.warn('transitioning to already showing template'),this.entryPage.if=!0):(this.entryInstance=this.lazy._getInstanceElement(this.entryPage),this.startAnimation())},stop:function(){if(!this.done){if(this._boundAnimationFinish){if(this.lazy._player&&this.lazy._player.onfinish){var b=this.lazy._player.onfinish;this.lazy._player.onfinish=function(){},b.apply(this.lazy._player)}this.lazy.cancelAnimation()}this.cleanup()}},handleDomChange:function(){this.done||(this.entryPage.removeEventListener('dom-change',this._boundDomChange),this.entryInstance=this.lazy._getInstanceElement(this.entryPage,!0),!this.entryInstance&&console.error('template missing an instance',this.entryPage),window.setTimeout(function(){this.startAnimation()}.bind(this),0))},startAnimation:function(){if(!this.done){this.entryInstance&&(this.lazy.fire('lazy-pages-transition-ready',{page:this.entryInstance,selected:this.entrySelected}),Polymer.dom(this.entryInstance).classList.add('iron-selected'));var b=this.lazy._getAnimations(this.entryPage,this.exitPage),c=[];b.entry&&(c.push({name:'opaque-animation',node:this.entryInstance}),c.push(b.entry)),b.exit&&c.push(b.exit),0<c.length?(this.lazy.animationConfig=c,this._boundAnimationFinish=this.animationFinish.bind(this),this.lazy.addEventListener('neon-animation-finish',this._boundAnimationFinish),this.lazy.playAnimation(null,this)):this.cleanup()}},animationFinish:function(b){b.detail!=this||this.cleanup()},cleanup:function(){this.done||(this.done=!0,this._boundAnimationFinish&&(this.lazy.removeEventListener('neon-animation-finish',this._boundAnimationFinish),delete this._boundAnimationFinish),this.exitInstance&&(this.isTemplate(this.exitPage)&&(this.exitPage.if=!1),Polymer.dom(this.exitInstance).classList.remove('neon-animating')),this.lazy._lazyTransition===this&&(this.lazy._lazyTransition=null),this.lazy._notifyPageResize())},isTemplate:function(b){return b&&'TEMPLATE'===b.nodeName}},'use strict',Polymer({is:'lazy-pages',behaviors:[Polymer.NeonAnimationRunnerBehavior,Polymer.IronResizableBehavior],properties:{selected:{type:String,notify:!0,observer:'_selectedChanged'},attrForSelected:{type:String,value:null},selectedItem:{type:Object,readOnly:!0,notify:!0},animateInitialSelection:{type:Boolean,value:!1},animationOracle:{type:Function},rescueSelection:{type:String}},_selectedChanged:function(b){if(null!=b){var d=this._findPageBySelected(b);d?this._selectPage(d,b):this.rescueSelection===void 0?console.warn('you should set rescueSelection attribute on lazy-pages to guard against bad selection',b):(d=this._findPageBySelected(this.rescueSelection),d?this.debounce('setselected',function(){this.selected=this._pageToSelected(d)}.bind(this)):console.error('rescueSelection page not found'))}},_pageToSelected:function(b){return this.attrForSelected?b.getAttribute(this.attrForSelected):this.items().indexOf(b)},items:function(){for(var b=Polymer.dom(this.$.content).getDistributedNodes(),c=[],d=new WeakMap,e=0;e<b.length;e++)if(1===b[e].nodeType&&'LINK'!=b[e].nodeName){var g=b[e];'TEMPLATE'===g.nodeName&&g._instance&&d.set(this._getInstanceElement(g),!0),c.push(g)}for(var e=c.length-1;0<=e;e--)d.has(c[e])&&c.splice(e--,1);return c},_findPageBySelected:function(b){var c=this.items();if(!this.attrForSelected)return c[b];for(var d=0;d<c.length;d++)if(c[d].getAttribute(this.attrForSelected)==b)return c[d];return null},_findCurrentSelected:function(){for(var b=this.items(),c=0;c<b.length;c++)if(Polymer.dom(b[c]).classList.contains('iron-selected'))return b[c];return null},_getAnimations:function(b,c){if(!c&&!this.animateInitialSelection)return{};var g,d=b?this._getInstanceElement(b):null,e=c?this._getInstanceElement(c):null;return this.animationOracle&&(g=this.animationOracle(b,c,d,e),g)?g:(g={},d&&(this.entryAnimation?g.entry={name:this.entryAnimation,node:d}:d.getAnimationConfig&&(g.entry={animatable:d,type:'entry'})),e&&(this.exitAnimation?g.exit={name:this.exitAnimation,node:e}:e.getAnimationConfig&&(g.exit={animatable:e,type:'exit'})),g)},_selectPage:function(b,c){b===this.selectedItem||(this._lazyTransition&&this._lazyTransition.stop(),this._lazyTransition=new a(this),this._lazyTransition.start(b,this.selectedItem,c))},_getInstanceElement:function(b,c){if(!b)return console.warn('template is null',b),null;if('TEMPLATE'!==b.nodeName)return b;if(!b._instance)return console.warn('template instance is null',b),null;for(var d=b._instance,e=null,g=0;g<d._children.length;g++)1===d._children[g].nodeType&&'LINK'!==d._children[g].nodeName?null==e?e=d._children[g]:console.warn('dom-if children inside lazy-pages can only have a single element',b):1===d._children[g].nodeType&&c&&console.warn('<link rel="import"> elements inside templates do not work in IE11 and Edge');return e||console.warn('template instance without element children',d),e},_loadImports:function(b){if(!b._lazyLoadedImports){b._lazyLoadedImports=!0;for(var e,c=b._instance,d=0;d<c._children.length;d++)e=c._children[d],1===e.nodeType&&'LINK'===e.nodeName&&'import'===e.getAttribute('rel')&&(Polymer.Base.importHref(e.href,function(){console.log('import success')},function(){console.log('import fail')}),c._children.splice(d,1),--d)}},_notifyPageResize:function(){if(this.selectedItem){this._getInstanceElement(this.selectedItem);this.notifyResize()}}})})();</script>
</body></html>