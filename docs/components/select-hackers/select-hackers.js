"use strict";const categories=["applied","accepted","waitlisted","rejected"];Object.freeze(categories);const responseCategories=["no response","going","not going","need reimbursement"];Object.freeze(responseCategories),Polymer({is:"select-hackers",properties:{hackers:{type:Array,value:[]},incr:{type:Number,value:0},categories:{type:Array,value:categories},filters:{type:Object,value:function(){return{search:"",status:"",response:""}}},responseCategories:{type:Array,value:responseCategories}},refresh:function(){this.incr++},attached:function(){var e=this;setTimeout(function(){e.resize()},100),window.addEventListener("resize",function(){e.resize()})},resize:function(){var e=this.$.list.getBoundingClientRect().top;this.$.list.style.height=window.innerHeight-e+"px"},observers:["refresh(filters.status)","refresh(filters.checked_in)","refresh(filters.response)","refresh(filters.search)","refresh(filters.mentor)","refresh(filters.first)","refresh(filters.reimbursement)","handleRegistrations(registrations)"],handleRegistrations:function(e){var t=[];for(var r in e){var i=e[r];i.id=r,t.push(i)}t.sort(function(e,t){return e.id<t.id});var n={};t.forEach(function(e,t){e.index=t;var r=e.email.toLowerCase().trim();n[r]=(n[r]||0)+1}),t.forEach(function(e){var t=e.email.toLowerCase().trim();n[t]>1&&(e.duplicate=!0)});const s=lunr(function(){this.ref("index"),this.field("city"),this.field("email"),this.field("emailSplit"),this.field("github"),this.field("personalsite"),this.field("linkedin"),this.field("name"),this.field("reason"),this.field("school")});t.forEach(function(e,t){var r=e.school.toLowerCase();(r.indexOf("secondary")>=0||r.indexOf("high")>=0)&&(e.hs=!0),e.status?categories.indexOf(e.status)==-1&&(e.status=categories[e.status]):e.status="applied",e.emailSplit=e.email.replace(/@/g," "),s.add(e)}),this.lunr=s,console.log("hackers update");const o=this.$.list.scrollTop;this.hackers=t,this.$.list.scroll(0,o)},cleanEmail:function(e){},responseCat:function(e){return this.responseCategories[e]},eq:function(e,t){return e==t},export:function(){var e=new CSV(this.filtered,{header:!0}).encode();this.downloadFile("applicants_export.csv",e)},downloadFile:function(e,t){var r=new Blob([t]);const i=document.createElement("a");i.setAttribute("download",e),i.setAttribute("href",URL.createObjectURL(r)),document.body.appendChild(i),i.click()},title:function(e){return e.name+" ("+e.email+")"},filter:function(e,t,r){var i=e;if(this.totalCount=e.length,t.search.length>0){var n=this.lunr.search(t.search);i=n.map(function(t){return e[t.ref]})}var s=t.status,o=t.response,a=this.responded(o),c=i.filter(function(e,r,i){var n=(""===s||"null"===s||"All"===s||s===e.status)&&(""===o||"null"===o||"All"===o||e.acceptance_sent&&a===e.response);return t.mentor&&(n=n&&e.mentor),t.checked_in&&(n=n&&e.checked_in),t.reimbursement&&(n=n&&e.travel_reimbursement),t.first&&(n=n&&e.first_hackathon),n});return this.filtered=c,this.filteredCount=c.length,c},resumeLink:function(e){return"https://firebasestorage.googleapis.com/v0/b/nwhacks-96701.appspot.com/o/"+encodeURIComponent(e)+"?alt=media"},githubLink:function(e){if(e)return e.indexOf("github.com")>0?e:"https://github.com/"+e},linkedinLink:function(e){if(e)return e.indexOf("linkedin.com")>0?e:"https://linkedin.com/in/"+e},selected:function(e){var t=categories.indexOf(e);return t>=0?t:0},responded:function(e){var t=responseCategories.indexOf(e);return t>=0?t:0},eq:function(e,t){return e===t},respondedWith:function(e,t){return e.acceptance_sent&&e.response===t},onSelect:function(e){var t=e.target.selectedIndex,r=categories[t],i=e.model.hacker;i.status!==r&&(this.set("hackers."+i.index+".status",r),this.patchHacker(i))},phoneChange:function(e){var t=e.model.hacker;this.patchHacker(t)},checkIn:function(e){var t=e.model.hacker;this.patchHacker(t)},patchHacker:function(e){this.$.regs.setStoredValue("/registrations/"+e.id,e)},refreshList:function(){this.incr++},handleErr:function(e,t,r){this.handleError(e,t.error)},hackerAdminURL:function(e){return"/api/admin/nwhacks/registration/"+e.id+"/change/"},handleError:function(e,t){console.log("Error",t),this.error=t,this.$.error.open()}});